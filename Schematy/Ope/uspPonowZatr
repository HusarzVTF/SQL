

USE Stacja_Paliw

GO

IF OBJECT_ID('Ope.uspPonowZatr') IS NOT NULL
DROP PROC Ope.uspPonowZatr;

GO

CREATE PROC Ope.uspPonowZatr (@idprac tinyint, @datazatrudnienia date, @pensja real )

AS

IF NOT EXISTS (SELECT IDPracownika FROM Ope.Pracownicy WHERE IDPracownika = @idprac)


THROW 901001, 'Wskazano pracownika, ktory nigdy nie byl zatrudniony.',1;


IF EXISTS (SELECT IDPracownika FROM Ope.Pracownicy WHERE IDPracownika = @idprac AND data_Zwolnienia IS NULL)

THROW 901002, 'Wskazano pracownika, ktory nigdy nie byl zwolniony.',1;


UPDATE Ope.Pracownicy SET data_Zatrudnienia = @datazatrudnienia, Pensja = @pensja, data_Zwolnienia = NULL
WHERE IDPracownika = @idprac AND data_Zatrudnienia IS NOT NULL

/* procedura na ponowne zatrudnienie pracownika */

