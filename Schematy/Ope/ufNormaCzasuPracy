

USE Stacja_Paliw

GO

IF OBJECT_ID('Ope.ufNormaCzasuPracy') IS NOT NULL
DROP FUNCTION Ope.ufNormaCzasuPracy;

GO

CREATE FUNCTION Ope.ufNormaCzasuPracy( @dat_od date, @dat_do date )


RETURNS int
WITH SCHEMABINDING  
AS
BEGIN 

DECLARE @norma_h_na_dz int = 8

DECLARE @dnirobocze int =( 

SELECT COUNT(ID) 
FROM Czas.Kalendarz 

WHERE
Data BETWEEN @dat_od AND @dat_do  
AND DATEPART(DW,Data) NOT IN (1,7) 
AND Dzien_Swiat IS NULL 

)

DECLARE @norma_czas_pracy int = @norma_h_na_dz * @dnirobocze


return @norma_czas_pracy;

END;

/* funkcja liczaca norme czasu pracy w podanym zakresie czasu */

