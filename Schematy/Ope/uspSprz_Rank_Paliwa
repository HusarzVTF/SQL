

 IF OBJECT_ID('Ope.uspPaliwa_SprzRanking') IS NOT NULL
 DROP PROC Ope.uspPaliwa_SprzRanking;

 --Instukcja sprawdzająca czy istnieje już procedura Ope.uspPaliwa_SprzRanking jeśli tak to jest likwidowana. Zakładamy, że jeśli istnieje to przez pomyłkę--


 GO

CREATE PROC Ope.uspPaliwa_SprzRanking
 
 AS

BEGIN

SELECT 
RodzajPaliwa, 
ISNULL(ROUND(SUM(IloscPaliwa),2),0) AS IloscPaliwa,
Z.JM,
ISNULL(ROUND(SUM(KwotaNetto),2),0) AS Wart_Paliwa_nt,
ISNULL(ROUND(SUM(KwotaBrutto),2),0) AS Wart_Paliwa_br,  
ISNULL(ROUND(SUM(KwotaBrutto)-SUM(KwotaNetto),2),0) AS  Podatek,
ISNULL(ROUND(SUM(KwotaNetto)/SUM(IloscPaliwa),2),0) AS Sr_Cena_Sprz_nt, 
ISNULL(ROUND(SUM(KwotaBrutto)/SUM(IloscPaliwa),2),0) AS Sr_Cena_Sprz_br

FROM Ope.Zbiorniki  AS Z
LEFT JOIN Ope.Sprzedaz AS S ON Z.IDPaliwa=S.IDPaliwa

GROUP BY  RodzajPaliwa,Z.RodzajPaliwa,Z.JM ORDER BY IloscPaliwa DESC

END;

--Procedura pokazująca zestawienie prezentujące sprzedaz paliwa posortowana od największej do najmniejszejs wg ilości sprzedanego paliwa. --
