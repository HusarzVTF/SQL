

IF OBJECT_ID('Ope.uspDostRanking_Paliwa') IS NOT NULL
DROP PROC Ope.uspDostRanking_Paliwa;

 --Instukcja sprawdzająca czy istnieje już procedura Ope.uspDostRanking_Paliwa jeśli tak to jest likwidowana. Zakładamy, że jeśli istnieje to przez pomyłkę--


 GO

CREATE PROC Ope.uspDostRanking_Paliwa
 
 AS


BEGIN

SELECT
RodzajPaliwa,
ISNULL(ROUND(SUM(IloscPaliwa),2),0) AS IloscPaliwa,
Z.JM,
ISNULL(ROUND(SUM(KwotaNetto),2),0) AS Wart_Paliwa_nt,
ISNULL(ROUND(SUM(KwotaBrutto),2),0) AS Wart_Paliwa_br, 
ISNULL(ROUND(SUM(KwotaBrutto)-SUM(KwotaNetto),2),0) AS  Podatek, 
ISNULL(ROUND(SUM(KwotaNetto)/SUM(IloscPaliwa),2),0) AS Sr_Cena_Zak_nt,
ISNULL(ROUND(SUM(KwotaBrutto)/SUM(IloscPaliwa),2),0) AS Sr_Cena_Zak_br

FROM Ope.Zbiorniki  AS Z
LEFT JOIN Ope.Dostawy AS D ON Z.IDPaliwa=D.IDPaliw

GROUP BY  RodzajPaliwa,Z.RodzajPaliwa,Z.JM ORDER BY IloscPaliwa DESC;

END;

/*procedura rankingujaca paliwa wg danych z dostaw */
