


USE Stacja_Paliw;


GO


IF OBJECT_ID('Ope.uspUdzWyd_W_PRZYCH') IS NOT NULL
DROP PROC Ope.uspUdzWyd_W_PRZYCH;
 
GO
 
CREATE PROC Ope.uspUdzWyd_W_PRZYCH
 
AS
 
BEGIN
 
DECLARE @Przych real=(SELECT SUM(Kwota) FROM [Stacja_Paliw].[Ope].[WynikOpe] WHERE Kategoria IN('Przychody'))
 

IF @Przych=0 OR @Przych IS NULL



THROW 510000000, 'Brak przychodów. Nie można wyliczyć udziału poszczególnych kategorii wydatków w przychodach', 1;


 ELSE

 SELECT  Kategoria,ROUND(Kwota/@Przych,2) AS Udzial FROM [Stacja_Paliw].[Ope].[WynikOpe] WHERE Kategoria NOT IN('Przychody','Wynik')
 
 END
 
 -- Procedura  liczaca udzial wydatkow w przychodach. Oczywiscie jesli nie ma przychodwo to nie da sie policzyc udzialu w nich. O tym informuje komunikat bledu. --
 
 
 
 
