

USE Stacja_Paliw;

GO


 IF OBJECT_ID ('Ope.trRab_Sprz_Ilo') IS NOT NULL
 DROP TRIGGER Ope.trRab_Sprz_Ilo;

  GO

CREATE TRIGGER Ope.trRab_Sprz_Ilo ON Ope.Sprzedaz AFTER INSERT, UPDATE
 
AS

IF EXISTS(


SELECT  Wartosc_Rabatu FROM Ope.Sprzedaz  WHERE Wartosc_Rabatu <> CAST(ROUND(Rabat_Jedn*IloscPaliwa,2) AS real) 

 

)
BEGIN
PRINT 'Niepoprawna wartosc rabatu. Wartosc rabatu musi sie rownac ilosci sprzedanego paliwa pomnozonej przez rabat jednostkowy.'
ROLLBACK TRANSACTION;
RETURN
END

/*blokuje wstawienie niepoprawnej wartosci rabatu  */
