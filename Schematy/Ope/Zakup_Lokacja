


USE Stacja_Paliw

GO


IF OBJECT_ID('Ope.uspZakup_Lokacja') IS NOT NULL
DROP PROC Ope.uspZakup_Lokacja


GO

CREATE PROC Ope.uspZakup_Lokacja
 
AS


SELECT 
D.IdDostawcy, 
NazwaDostawcy,
RodzajPaliwa,
SUM(Dst.IloscPaliwa) AS Ilosc,
SUM(Dst.KwotaNetto) AS NetWar,
W.Wojewodztwo,
P.Powiat,
G.Gmina,
M.Miejscowosc

FROM Stacja_Paliw.Ope.Dostawcy AS D
INNER JOIN Stacja_Paliw.Ope.Dostawy AS Dst
ON Dst.IdDostawcy=D.IdDostawcy

INNER JOIN Stacja_Paliw.Ope.Zbiorniki AS Z
ON Z.IDPaliwa=Dst.IDPaliw

INNER JOIN Stacja_Paliw.Lokacje.Miejscowosc AS M
ON M.IDMiej=D.IDMiejscowosc

INNER JOIN Stacja_Paliw.Lokacje.Gmina AS G
ON G.IdGminy=M.IDGminy

INNER JOIN Stacja_Paliw.Lokacje.Powiat AS P
ON P.IdPowiatu=G.IdPowiatu

INNER JOIN Stacja_Paliw.Lokacje.Wojewodztwa AS W
ON W.IdWoj=P.IdWOJ

GROUP BY D.IdDostawcy,NazwaDostawcy,RodzajPaliwa,Wojewodztwo,Powiat,Gmina,Miejscowosc
ORDER BY SUM(Dst.IloscPaliwa) DESC


/*Procedura cahrakteryzujaca zakupy paliwa pod wzgledem ilosci i typu paliwa oraz lokacji w jakiej jest zarejestrowany dostawca*/



