

USE Stacja_Paliw

GO

IF OBJECT_ID('Ope.trPensja_OD') IS NOT NULL
DROP TRIGGER Ope.trPensja_OD; 

GO

CREATE TRIGGER trPensja_OD ON Ope.Pracownicy AFTER UPDATE

AS

IF EXISTS(

SELECT IDPracownika

FROM Ope.Pracownicy

WHERE 

Pensja_OD IS NULL

OR

Pensja_OD < data_Zatrudnienia OR Pensja_OD > data_Zwolnienia

OR

Pensja_OD NOT IN (SELECT Data FROM Czas.Kalendarz)
)

BEGIN
PRINT 'Pensja_OD nie moze byc pusta w tabeli pracownicy ani byc spoza zakresu tabeli kalendarz ani wypadac przed data zatrudnienia ani po dacie zwolnienia.'
ROLLBACK TRANSACTION;
RETURN
END

/* trigger blokujacy zaktualizowanie atrybutu Pensja_Od do niepoprawnej daty */




