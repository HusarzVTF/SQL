

USE Stacja_Paliw;

GO

IF OBJECT_ID('Ope.uspDostRanking_Paliwa') IS NOT NULL
DROP PROC Ope.uspDostRanking_Paliwa;

--Sprawdzenie czy istnieje procedura uspTopDostawcy. Jeśli tak to likwiduje ją, zakładamy że jeśli już istniała to została stworzona przez pomyłkę.--

GO

CREATE PROC Ope.uspDostRanking_Paliwa AS
BEGIN
SELECT 
RodzajPaliwa,
SUM(IloscPaliwa) AS IloscPaliwa,
Z.JM,
SUM(KwotaNetto) AS WartoscPaliwa,
SUM(KwotaBrutto) AS WartoscBruttoPaliwa, 
SUM(KwotaBrutto)-SUM(KwotaNetto) AS  Podatek, 
SUM(KwotaNetto)/SUM(IloscPaliwa) AS SRCenaZAKUPUNetto,
SUM(KwotaBrutto)/SUM(IloscPaliwa) AS SRCenaZAKUPUBrutto
FROM Ope.Dostawy  AS D
INNER JOIN Ope.Zbiorniki AS Z ON Z.IDPaliwa=D.IDPaliw
GROUP BY  RodzajPaliwa,Z.RodzajPaliwa,Z.JM ORDER BY IloscPaliwa DESC;
END;

--Procedura pokazująca zestawienie rodzajow zakupionego paliwa posortowane wg ilosc  w kolejnosci  od największego do najmniejszego--


