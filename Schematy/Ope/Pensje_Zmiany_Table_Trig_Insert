

USE Stacja_Paliw

GO

IF OBJECT_ID ('Ope.Pensje_Zmiany') IS NOT NULL
DROP TABLE Ope.Pensje_Zmiany;

CREATE TABLE Ope.Pensje_Zmiany 
(ID INT  IDENTITY PRIMARY KEY,
ID_pracownika  TINYINT not null FOREIGN KEY REFERENCES Ope.Pracownicy (IDPracownika),
Pensja real not null CHECK(Pensja > 0),
OD date not null FOREIGN KEY REFERENCES Czas.Kalendarz (Data),
DO date )

/* tworzenie tabeli Pensje_Zmiany */

GO

IF OBJECT_ID('Ope.trDoCheck') IS NOT NULL
DROP TRIGGER Ope.trDoCheck;

GO

CREATE TRIGGER Ope.trDoCheck ON Ope.Pensje_Zmiany AFTER  INSERT, UPDATE

AS

IF EXISTS ( 
SELECT ID FROM Ope.Pensje_Zmiany WHERE 
DO < OD 
OR 
DO NOT IN (SELECT Data FROM Czas.Kalendarz )

)
BEGIN
PRINT 'Bledna data do wzgledem od lub do nie moze byc spoza zakresu tabeli kalendarz.';
ROLLBACK TRANSACTION
END




/* triggery walidujace dane w tabeli pensje_zmiany */

GO


INSERT INTO Ope.Pensje_Zmiany (ID_pracownika, Pensja, OD)
SELECT  IDPracownika, Pensja, (SELECT MIN(data) FROM Stacja_Paliw.Czas.Kalendarz)
FROM Ope.Pracownicy

/* wstawienie danych do tabeli Pensje_zmiany */




